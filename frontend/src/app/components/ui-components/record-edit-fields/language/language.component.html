<mat-form-field class="language-form-field" appearance="outline">
    <mat-label>{{normalizedLabel()}}</mat-label>
    <div class="language-input-container">
        @if (selectedLanguageFlag() && showFlag()) {
            <span class="language-flag-prefix">{{selectedLanguageFlag()}}</span>
        }
        <input type="text" matInput
            [required]="required()" [disabled]="disabled()" [readonly]="readonly()"
            attr.data-testid="record-{{label()}}-language"
            [formControl]="languageControl"
            [matAutocomplete]="auto"
            class="language-input">
    </div>
    <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
        @for (language of filteredLanguages(); track language.value) {
            <mat-option
                [value]="language"
                (onSelectionChange)="language && onLanguageSelected(language)">
                @if (language.flag && showFlag()) {
                    <span class="language-flag">{{language.flag}}</span>
                }
                <span class="language-name">{{language.label}}</span>
                @if (language.nativeName && language.label !== language.nativeName) {
                    <span class="language-native">{{language.nativeName}}</span>
                }
                @if (language.value) {
                    <span class="language-code">({{language.value}})</span>
                }
            </mat-option>
        }
    </mat-autocomplete>
</mat-form-field>
