<div class="s3-widget">
  <mat-form-field class="s3-widget__key" appearance="outline">
    <mat-label>{{normalizedLabel()}}</mat-label>
    <input matInput type="text" name="{{label()}}-{{key()}}"
      [required]="required()" [disabled]="disabled()" [readonly]="readonly()"
      attr.data-testid="record-{{label()}}-s3"
      [ngModel]="internalValue() || value()" (ngModelChange)="onValueChange($event)">
  </mat-form-field>

  <div class="s3-widget__actions">
    <input type="file" #fileInput hidden [accept]="fileAccept()" (change)="onFileSelected($event)">
    <button mat-stroked-button type="button"
            [disabled]="disabled() || readonly() || isLoading()"
            (click)="fileInput.click()">
      <mat-icon>upload</mat-icon>
      Upload
    </button>
    @if (previewUrl()) {
      <button mat-stroked-button type="button"
              (click)="openFile()">
        <mat-icon>open_in_new</mat-icon>
        Open
      </button>
    }
  </div>

  @if (internalValue() || value()) {
    <div class="s3-widget__preview">
      @if (isLoading()) {
        <mat-spinner diameter="40"></mat-spinner>
      } @else if (isImage() && previewUrl()) {
        <img [src]="previewUrl()"
             class="s3-widget__thumbnail"
             alt="Preview">
      } @else if (previewUrl()) {
        <div class="s3-widget__file-icon">
          <mat-icon>insert_drive_file</mat-icon>
          <span class="s3-widget__filename">{{(internalValue() || value()) | slice:-30}}</span>
        </div>
      }
    </div>
  }
</div>
