<div class="profile-layout">
    <app-profile-sidebar activeTab="api"></app-profile-sidebar>

    <div class="profile-main">
        <app-alert></app-alert>

        <div class="api-keys-page">
            <h1 class="mat-h1">API Keys</h1>
            <p class="api-keys-description">
                Generate and manage API keys to access Rocketadmin programmatically.
            </p>

            <div class="api-keys-content">
                <form class="api-key-form" (ngSubmit)="generateAPIkey()">
                    <mat-form-field appearance="outline" class="api-key-form__input">
                        <mat-label>API key title</mat-label>
                        <input matInput name="api-key-title" #apiKeyTitle="ngModel"
                            data-testid="api-key-input"
                            angulartics2On="change"
                            angularticsAction="API Keys: api key title is edited"
                            (change)="posthog.capture('API Keys: api key title is edited')"
                            [(ngModel)]="generatingAPIkeyTitle">
                    </mat-form-field>
                    <button type="submit" mat-flat-button color="primary" data-testid="generate-api-key-button"
                        class="api-key-form__generate-button"
                        [disabled]="!generatingAPIkeyTitle || submitting">
                        {{submitting ? 'Generating...' : 'Generate'}}
                    </button>
                </form>

                <div *ngIf="generatedAPIkeyHash" class="api-key-value">
                    <mat-form-field appearance="outline" class="api-key-value__input">
                        <mat-label>API key</mat-label>
                        <input matInput name="token" #token="ngModel" readonly
                            data-testid="api-key-value-input"
                            [(ngModel)]="generatedAPIkeyHash">
                        <mat-hint>
                            Please save this API key. You won't be able to see it again.
                        </mat-hint>
                    </mat-form-field>
                    <button type="button" mat-icon-button
                        data-testid="api-key-value-copy-button"
                        class="api-key-value__copy-button"
                        matTooltip="Copy API key"
                        [cdkCopyToClipboard]="generatedAPIkeyHash"
                        (cdkCopyToClipboardCopied)="showCopyNotification('API key was copied to clipboard.')">
                        <mat-icon>content_copy</mat-icon>
                    </button>
                </div>

                <div class="api-keys-list">
                    <h3 class="api-keys-list__heading">Your API keys</h3>

                    <app-placeholder-api-keys-list *ngIf="!apiKeys"></app-placeholder-api-keys-list>

                    <div *ngIf="apiKeys && apiKeys.length === 0" class="api-keys-empty">
                        <mat-icon class="api-keys-empty__icon">vpn_key_off</mat-icon>
                        <p>You don't have any API keys yet.</p>
                    </div>

                    <mat-list role="list" *ngIf="apiKeys && apiKeys.length" class="api-keys-items">
                        <mat-list-item role="listitem" *ngFor="let apiKey of apiKeys; let i=index" class="api-key-list-item">
                            <div class="api-key-item">
                                <div class="api-key-item__info">
                                    <mat-icon class="api-key-item__icon">vpn_key</mat-icon>
                                    <span class="api-key-item__title">{{apiKey.title}}</span>
                                </div>
                                <button type="button" mat-icon-button
                                    attr.data-testid="api-key-{{i}}-delete-button"
                                    matTooltip="Delete API key"
                                    color="warn"
                                    (click)="deleteAPIkey(apiKey)">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </mat-list-item>
                    </mat-list>
                </div>
            </div>
        </div>
    </div>
</div>
